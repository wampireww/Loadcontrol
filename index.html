<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>HLC - Classic Design Pro Summary</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<style>
/* Klasik Tasarım Ayarları */
html, body { overscroll-behavior-y: contain; }
body{font-family: Arial, sans-serif; background:#f0f2f5; margin:5px; padding-bottom:120px; color: #333;}

section{background:#fff; border:1px solid #ccc; border-radius:8px; padding:8px; margin-bottom:8px;}
h1{text-align:center; color:#004080; margin:5px; font-size:1.4em;}
h3{cursor:pointer; margin:4px 0; display:flex; justify-content:space-between; align-items:center;}

.flex{display:flex; flex-wrap:wrap; align-items:center; gap:5px;}
input[type=number], input[type=text]{width:60px; padding:3px; border:1px solid #ccc; border-radius:4px;}
button{background:#004080; color:#fff; border:none; border-radius:4px; padding:4px 8px; cursor:pointer;}

.compartment{border-top:1px solid #aaa; margin-top:5px; padding-top:5px;}
.content{display:none; background:#fafafa; padding:6px; border-radius:4px;}

/* Cargo ve Manuel İçin İkili Dizilim */
.items-container { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
.item-wrapper {
    display: flex; align-items: center; justify-content: space-between;
    background: #eee; padding: 3px; border-radius: 4px; border: 1px solid #999;
    width: 48%; box-sizing: border-box; font-size: 0.85em; color: #000;
}
/* İlk eklenen kalem tam genişlik veya butonun yanına sığsın dersen auto yapabiliriz, 
   ama düzenli olması için hepsini 48% (ikili) yaptım */
.item-input { width: 45px !important; margin: 0 5px; font-weight: bold; border: 1px solid #888 !important;}
.delete-btn { background: #cc0000; padding: 2px 5px; font-size: 0.8em; border-radius: 3px;}

/* SENİN ÇOK BEĞENDİĞİN FİNAL KONTROL PANELİ */
.summary{ background:#004080; color: white; padding:15px; border-radius: 15px; border: 2px solid #002b57; margin-top: 20px;}
.summary h3 { color: white; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 8px; margin-bottom: 10px; font-size: 1.2em;}
.weight-display { font-size: 0.95em; color: #004080; font-weight: bold; background: #e6f0ff; padding: 2px 6px; border-radius: 4px; }
.midBadge { font-size: 0.8em; color: #555; font-weight: bold; margin-right: auto; margin-left: 10px;}

/* NOTLAR KISMI - BÜYÜK, SİYAH, OKUNAKLI */
#note { 
    width: 100%; height: 100px; margin-top: 15px; border-radius: 10px; padding: 12px; 
    border: 2px solid #fff; box-sizing: border-box; font-size: 16px; 
    color: #000000; font-weight: bold; background-color: #ffffff;
}
.final-row { display: flex; justify-content: space-between; margin-top: 12px; font-size: 1.1em; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px; font-weight: bold;}
</style>
</head>
<body>

<h1>Harekat Load Control</h1>

<section class="flex">
    Uçak: <select id="aircraft" onchange="fullReset();checkLoadType()">
        <option value="">Seç</option>
        <option>A319</option><option>A320</option><option>A321</option><option>B737</option>
        <option>A330</option><option>A350</option><option>B777</option><option>B787</option>
    </select>
    Yükleme: <select id="loadType" onchange="checkLoadType()">
        <option value="">Seç</option>
        <option value="YIGMA">Yığma</option>
        <option value="ULD">ULD</option>
    </select>
</section>

<section class="flex">
    Water <input type="number" id="waterInput" oninput="saveAll();updateSummary()">
    Pantry <input type="number" id="pantryInput" oninput="saveAll();updateSummary()">
</section>

<section>
    <h3>Bagaj Ortalamaları</h3>
    <div class="flex">
        By <input type="number" id="byAvg" value="13" oninput="updateMix()">
        Bc <input type="number" id="bcAvg" value="11" oninput="updateMix()">
        Mix <input type="number" id="mxAvg" readonly>
    </div>
</section>

<div id="compartments"></div>

<section class="summary">
    <h3>Final Kontrol</h3>
    <div id="summary" style="line-height: 1.8;"></div>
    <div class="final-row">
        <span>Water: <span id="finalWater">0</span></span>
        <span>Pantry: <span id="finalPantry">0</span></span>
    </div>
    <textarea id="note" placeholder="Ekip notlarını buraya yazın..." oninput="saveAll()"></textarea>
    <div class="flex" style="justify-content: space-between; margin-top: 15px;">
        <button onclick="saveAll()" style="background: #2ecc71; flex:1; margin-right:8px; font-weight:bold; padding:10px;">KAYDET</button>
        <button onclick="clearStorage()" style="background:#e74c3c; flex:1; font-weight:bold; padding:10px;">SIFIRLA</button>
    </div>
</section>

<script>
const comps={A319:[1,4,5],A320:[1,3,4,5],A321:[1,2,3,4,5],B737:[1,2,3,4],A330:[1,2,3,4,5],A350:[1,2,3,4,5],B777:[1,2,3,4,5],B787:[1,2,3,4,5]};
const wide=["A330","A350","B777","B787"];

function fullReset(){ document.getElementById('compartments').innerHTML=""; updateSummary(); saveAll(); }
function clearStorage() { if(confirm("Veriler silinsin mi?")) { localStorage.removeItem("hlc_data"); location.reload(); } }

function updateMix(){
  const by = +document.getElementById('byAvg').value||0;
  const bc = +document.getElementById('bcAvg').value||0;
  document.getElementById('mxAvg').value = (by+bc)>0 ? (by+bc)/2 : "";
  updateSummary(); saveAll();
}

function checkLoadType(){
  const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value;
  if(!lt){fullReset(); return;}
  if((ac==="B737"&&lt==="ULD")||(wide.includes(ac)&&lt==="YIGMA")){
    alert("Uçak/Yükleme tipi uyumsuz!"); document.getElementById('loadType').value=""; fullReset(); return;
  }
  updateCompartments(true);
}

function updateCompartments(r){
  const container = document.getElementById('compartments');
  if(r) container.innerHTML="";
  const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value;
  if(!ac || !lt) return;

  comps[ac].forEach(n=>{
    const s=document.createElement("section");
    s.className="compartment"; s.dataset.num=n;
    s.innerHTML=`<h3 onclick="toggleContent(this)">CPT ${n} <span class="midBadge"></span> <span class="weight-display">0 kg</span></h3>
    <div class="content">
      <div class="bag-section"></div>
      <div style="margin-top:5px;">Cargo <button onclick="addItem(this,'Cargo')">+</button><div class="items-container"></div></div>
      <div style="margin-top:5px;">Manuel <button onclick="addItem(this,'Manuel')">+</button><div class="items-container"></div></div>
    </div>`;
    const bagSec = s.querySelector(".bag-section");
    if(lt==="YIGMA" || n===5){
      bagSec.innerHTML=`<div class="flex">By<input type="number" class="by" oninput="updateSummary();saveAll()"> Bc<input type="number" class="bc" oninput="updateSummary();saveAll()"> Mix<input type="number" class="mx" oninput="updateSummary();saveAll()"></div>`;
    } else {
      const lbl=wide.includes(ac)?"AKE":"AKH";
      bagSec.innerHTML=`<div class="flex"><strong>${lbl}</strong> <select class="bagType"><option>By</option><option>Bc</option><option>Mix</option></select> <button onclick="addBagaj(this)">+</button></div><div class="items-container"></div>`;
    }
    container.appendChild(s);
  });
}

function toggleContent(el){ const c=el.nextElementSibling; c.style.display=(c.style.display==='block')?'none':'block'; }

function renumberGlobalBag(type){
  let i=1; document.querySelectorAll(`.konteyner-item[data-type="${type}"]`).forEach(e=>{ e.querySelector('span').textContent=type+" "+(i++); });
}

function renumberLocal(container, kind){
  let i=1; container.querySelectorAll(`.local-item[data-kind="${kind}"]`).forEach(e=>{ e.querySelector('span').textContent=kind+" "+(i++); });
}

function addBagaj(b, savedVal=null){
  const t=b.previousElementSibling.value, holder=b.parentElement.nextElementSibling;
  const d=document.createElement("div"); d.className="konteyner-item item-wrapper"; d.dataset.type=t; d.dataset.kind=t;
  d.innerHTML=`<span>${t}</span><input type="number" class="item-input" value="${savedVal||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="this.parentElement.remove(); renumberGlobalBag('${t}'); updateSummary(); saveAll()">X</button>`;
  holder.appendChild(d); renumberGlobalBag(t); updateSummary(); saveAll();
}

function addItem(b, k, savedVal=null){
  const holder=b.nextElementSibling;
  const d=document.createElement("div"); d.className="local-item item-wrapper"; d.dataset.kind=k;
  d.innerHTML=`<span>${k}</span><input type="number" class="item-input" value="${savedVal||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="const h=this.parentElement.parentElement; this.parentElement.remove(); renumberLocal(h,'${k}'); updateSummary(); saveAll()">X</button>`;
  holder.appendChild(d); renumberLocal(holder, k); updateSummary(); saveAll();
}

function updateSummary(){
  let out=""; const byA=+document.getElementById('byAvg').value||0, bcA=+document.getElementById('bcAvg').value||0, mxA=+document.getElementById('mxAvg').value||0;
  document.querySelectorAll(".compartment").forEach(c=>{
    let t=0;
    c.querySelectorAll(".by").forEach(i=>t+=(+i.value||0)*byA);
    c.querySelectorAll(".bc").forEach(i=>t+=(+i.value||0)*bcA);
    c.querySelectorAll(".mx").forEach(i=>t+=(+i.value||0)*mxA);
    c.querySelectorAll(".konteyner-item").forEach(k=>{
      const v=+k.querySelector("input").value||0, avg=(k.dataset.type==="By")?byA:(k.dataset.type==="Bc")?bcA:mxA;
      t+=(v*avg+70)-v;
    });
    c.querySelectorAll(".local-item").forEach(i=>t+=+i.querySelector("input").value||0);
    c.querySelector(".weight-display").textContent=Math.round(t)+" kg";
    out+=`<div>CPT ${c.dataset.num}: <strong>${Math.round(t)} kg</strong></div>`;
  });
  document.getElementById('summary').innerHTML=out;
  document.getElementById('finalWater').textContent=document.getElementById('waterInput').value||"0";
  document.getElementById('finalPantry').textContent=document.getElementById('pantryInput').value||"0";
  updateCPTBadge();
}

function updateCPTBadge(){
  document.querySelectorAll('.compartment').forEach(c=>{
    const lt=document.getElementById('loadType').value, n=parseInt(c.dataset.num);
    let B=0, C=c.querySelectorAll('.local-item[data-kind="Cargo"]').length, M=c.querySelectorAll('.local-item[data-kind="Manuel"]').length;
    if(lt==='YIGMA' || n===5) c.querySelectorAll('.by, .bc, .mx').forEach(i=>B+=+i.value||0);
    else B=c.querySelectorAll('.konteyner-item').length;
    const mid=c.querySelector('.midBadge');
    let res=[]; if(B) res.push("B "+B); if(C) res.push("C "+C); if(M) res.push("Mn "+M);
    mid.textContent=res.join(" / ");
  });
}

function saveAll(){
  const data = { ac: document.getElementById('aircraft').value, lt: document.getElementById('loadType').value, w: document.getElementById('waterInput').value, p: document.getElementById('pantryInput').value, by: document.getElementById('byAvg').value, bc: document.getElementById('bcAvg').value, n: document.getElementById('note').value, comps: [] };
  document.querySelectorAll('.compartment').forEach(c => {
    let cObj = { num: c.dataset.num, yigma: [], items: [] };
    c.querySelectorAll('.by, .bc, .mx').forEach(i => cObj.yigma.push(i.value));
    c.querySelectorAll('.item-wrapper').forEach(iw => { cObj.items.push({ k: iw.dataset.kind || iw.dataset.type, v: iw.querySelector('input').value, isK: iw.classList.contains('konteyner-item') }); });
    data.comps.push(cObj);
  });
  localStorage.setItem("hlc_data", JSON.stringify(data));
}

function loadAll(){
  const raw = localStorage.getItem("hlc_data"); if(!raw) return;
  const data = JSON.parse(raw);
  document.getElementById('aircraft').value=data.ac; document.getElementById('loadType').value=data.lt;
  if(!data.ac || !data.lt) return;
  updateCompartments(true);
  document.getElementById('waterInput').value=data.w; document.getElementById('pantryInput').value=data.p;
  document.getElementById('byAvg').value=data.by; document.getElementById('bcAvg').value=data.bc;
  document.getElementById('note').value=data.n;
  const domComps = document.querySelectorAll('.compartment');
  data.comps.forEach((cData, idx) => {
    const dc = domComps[idx]; if(!dc) return;
    const yI = dc.querySelectorAll('.by, .bc, .mx');
    cData.yigma.forEach((val, i) => { if(yI[i]) yI[i].value = val; });
    cData.items.forEach(item => {
      if(item.isK) { dc.querySelector('.bagType').value = item.k; addBagaj(dc.querySelector('.bag-section button'), item.v); }
      else { const btns = dc.querySelectorAll('.content button'); const targetBtn = item.k === 'Cargo' ? btns[btns.length-2] : btns[btns.length-1]; addItem(targetBtn, item.k, item.v); }
    });
  });
  updateSummary();
}
window.onload = loadAll;
</script>
</body>
</html>
