<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>HLC - Pro Master V33.7 STABIL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<style>
html, body { overscroll-behavior-y: contain; }
body{font-family: 'Segoe UI', Arial, sans-serif; background:#f0f2f5; margin:5px; padding-bottom:150px; color: #333;}
section{background:#fff; border:1px solid #ccc; border-radius:8px; padding:8px; margin-bottom:8px;}
h1{text-align:center; color:#004080; margin:5px; font-size:1.3em;}
h3{cursor:pointer; margin:4px 0; display:flex; align-items:center; font-size: 1.05em; color:#004080; font-weight: bold;}
.flex{display:flex; flex-wrap:wrap; align-items:center; gap:6px;}
input[type=number], input[type=text], select{padding:2px 6px; border:1px solid #ccc; border-radius:4px; font-size: 15px; font-weight: bold; height: 34px; box-sizing: border-box;}
.add-btn { background:#004080; color:#fff; border:none; border-radius:4px; width: 28px; height: 28px; cursor:pointer; font-weight: bold; font-size: 18px; display: flex; align-items: center; justify-content: center;}
.midBadge { font-size: 0.82em; color: #d35400; font-weight: 800; flex-grow: 1; text-align: center; }
.item-wrapper { display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 3px 5px; border-radius: 6px; border: 1.8px solid #004080; width: 48.5%; box-sizing: border-box; margin-bottom: 5px; }
.item-wrapper span { font-size: 13px; font-weight: 600; color: #444; }
.eic-wrapper { background: #fff2cc !important; border-color: #f1c232 !important; width: 48.5% !important; margin-bottom: 8px; }
.items-container { display: flex; flex-wrap: wrap; gap: 3%; margin-top: 5px; }
.item-input { width: 70px !important; height: 26px !important; margin: 0 2px; font-weight: 900; border: 1.2px solid #777 !important; text-align: center;}
.delete-btn { background: #cc0000; padding: 0 6px; height: 26px; border-radius: 4px; color: white; border:none; font-weight: bold;}
.weight-display { font-size: 0.92em; color: #004080; font-weight: 900; background: #e6f0ff; padding: 4px 6px; border-radius: 5px; }
#note { width: 100%; height: 80px; margin-top: 15px; border-radius: 8px; padding: 8px; font-size: 14px; font-weight: bold; border: 1px solid #ccc; box-sizing: border-box; }
.summary{ background:#004080; color: white; padding:15px; border-radius: 12px; border: 2px solid #002b57; margin-top: 10px;}
.action-btn { flex: 1; height: 36px; border-radius: 6px; border: none; color: white; font-weight: bold; font-size: 13px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px;}
.summary-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 15px; }
.summary-header h3 { color: white !important; margin: 0 !important; font-size: 16px !important; font-weight: 800 !important; }
.header-inputs { display: flex; gap: 4px; align-items: center; font-size: 16px; font-weight: 800; }
.header-input { width: 55px; background: rgba(255,255,255,0.1); border: none; border-bottom: 1.5px solid white; color: white; font-size: 16px; text-align: center; text-transform: uppercase; font-weight: 800; height: 25px !important; }
.summary-line { margin-bottom: 6px; font-size: 16px; display: flex; align-items: center; }
.summary-label { color: rgba(255,255,255,0.7); width: 60px; font-weight: 400; font-size: 15px; }
.summary-val { font-weight: 800; font-size: 17px; }
.summary-divider { height: 1px; background: rgba(255,255,255,0.15); margin: 15px 0; }
.total-payload { font-size: 1.05em; color: #ffeb3b; border-top: 1.5px solid rgba(255,255,255,0.2); padding-top: 12px; margin-top: 10px; text-align: center; width: 100%; font-weight: 800; }
.content { display: none; padding: 10px; border-top: 1px solid #eee; }
.add-row { display: flex; align-items: center; gap: 8px; margin-top: 10px; }
</style>
</head>
<body>

<h1>HLC Pro Master V33.7 STABIL</h1>

<section class="flex">
    U√ßak: <select id="aircraft" onchange="fullReset();checkLoadType();updateWaterUI();updateSummary();saveAll()" style="flex:1;">
        <option value="">Se√ß</option>
        <option>A319</option><option>A320</option><option>A321</option>
        <option>B737-800</option><option>B737-900</option>
        <option>A330</option><option>A350</option><option>B777</option><option>B787</option>
    </select>
    Y√ºkleme: <select id="loadType" onchange="checkLoadType();saveAll()" style="flex:1;">
        <option value="">Se√ß</option><option value="YIGMA">Yƒ±ƒüma</option><option value="ULD">ULD</option>
    </select>
</section>

<section><h3 onclick="toggleContent(this)">Water & Pantry</h3><div class="content"><div id="waterUI" style="display:flex; flex-direction:column; gap:8px;"></div><div class="flex" style="margin-top:12px;">Pantry Code: <input type="text" id="pantryInput" style="flex-grow:1" oninput="saveAll();updateSummary()"></div></div></section>
<section><h3 onclick="toggleContent(this)">Bagaj Ortalamalarƒ±</h3><div class="content" style="display: block;"><div class="flex" style="font-weight: bold; justify-content: space-between;"><div>By <input type="number" id="byAvg" style="width:78px" oninput="updateMix()"></div><div>Bc <input type="number" id="bcAvg" style="width:78px" oninput="updateMix()"></div><div>Mix <input type="number" id="mxAvg" style="width:78px" readonly></div></div></div></section>

<div id="compartments"></div>

<section class="summary">
    <div class="summary-header"><h3>FINAL KONTROL</h3><div class="header-inputs"><span>TC-</span><input type="text" id="tailInput" class="header-input" style="width:55px;" oninput="saveAll()"><span style="color:white; margin-left:5px;">/</span><input type="text" id="destInput" class="header-input" style="width:50px;" oninput="saveAll()"></div></div>
    <div id="summary-list"></div><div class="summary-divider"></div><div id="summary-details"></div><div class="summary-divider"></div>
    <div class="summary-line"><span class="summary-label" style="width:80px">WATER:</span><span class="summary-val" id="finalWater">-</span></div>
    <div class="summary-line"><span class="summary-label" style="width:80px">PANTRY:</span><span class="summary-val" id="finalPantry">-</span></div>
    <div class="total-payload">TOTAL PAYLOAD: <span id="totalPayload">0</span> kg</div>
    <textarea id="note" placeholder="Operasyon Notu Ekle..." oninput="saveAll()"></textarea>
    <div class="flex" style="justify-content: space-between; margin-top: 15px; gap: 10px;"><button class="action-btn" onclick="saveAll()" style="background: #27ae60;">KAYDET</button><button class="action-btn" onclick="clearStorage()" style="background:#c0392b;">SIFIRLA</button></div>
</section>

<script>
const waterData = { "A330": { "JNA, JNB (Grup A)": {"25": [-525,-2.6],"50": [-350,-1.7],"75": [-175,-0.9],"FULL": [0,0]}, "JNF, JNG, JNH, JNI, JNJ, JNK (Grup B)": {"25": [-788,-3.5],"50": [-525,-2.4],"75": [-263,-1.2],"FULL": [0,0]}, "JNH ... JNZ (Standart)": {"25": [-525,-2.0],"50": [-350,-1.4],"75": [-175,-0.7],"FULL": [0,0]}, "TC-LOA ... LOZ (Yeni Seri)": {"25": [-788,-4.2],"50": [-525,-2.8],"75": [-263,-1.4],"FULL": [0,0]}, "TC-LON (√ñzel Deƒüerler)": {"25": [-788,-4.2],"50": [-525,-2.8],"75": [-263,-1.4],"FULL": [0,0]} }, "A350": { "LGA, LGB, LGC... (Grup A-C)": {"1/10": [-954,-4.4], "2/10": [-848,-3.9], "3/10": [-742,-3.4], "4/10": [-636,-2.9], "5/10": [-530,-2.4], "6/10": [-424,-1.9], "7/10": [-318,-1.5], "8/10": [-212,-1.0], "9/10": [-106,-0.5], "FULL": [0,0]}, "LGR, LGS, LGT... (Grup B)": {"1/10": [-1350,-6.0], "2/10": [-1200,-5.3], "3/10": [-1050,-4.7], "4/10": [-900,-4.0], "5/10": [-750,-3.3], "6/10": [-600,-2.7], "7/10": [-450,-2.0], "8/10": [-300,-1.3], "9/10": [-150,-0.7], "FULL": [0,0]} }, "B737-800": {"25": [-177,-2.5], "50": [-118,-1.7], "75": [-59,-0.8], "FULL": [0,0]}, "B737-900": {"25": [-178,-2.7], "50": [-119,-1.8], "75": [-59,-0.9], "FULL": [0,0]}, "B787": {"1/8": [-924,-3.9], "FULL": [0,0]}, "B777": {"1/8": [-1172,-3.9], "FULL": [0,0]}, "A319": {"25": [-150,-1.7], "FULL": [0,0]}, "A320": {"25": [-150, 0.5], "FULL": [0,0]}, "A321": {"25": [-150,-2.3], "FULL": [0,0]} };
const comps={A319:[1,4,5],A320:[1,3,4,5],A321:[1,2,3,4,5],"B737-800":[1,2,3,4],"B737-900":[1,2,3,4],A330:[1,2,3,4,5],A350:[1,2,3,4,5],B777:[1,2,3,4,5],B787:[1,2,3,4,5]};

function updateSummary(){
    let outHtml="", totalPayload=0, totalBags=0, totalULDCount=0, totalCargo=0, totalManuel=0;
    const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value;
    const byA=+document.getElementById('byAvg').value||0, bcA=+document.getElementById('bcAvg').value||0, mxA=+document.getElementById('mxAvg').value||0;

    document.querySelectorAll(".compartment").forEach(c=>{
        let cptW=0, cptBags=0, cptULDs=0;
        const cptNum = parseInt(c.dataset.num);
        c.querySelectorAll(".by,.bc,.mx").forEach(i=>{ let v=+i.value||0; cptBags+=v; totalBags+=v; cptW+=v*(i.classList.contains('by')?byA:(i.classList.contains('bc')?bcA:mxA)); });
        c.querySelectorAll(".konteyner-item").forEach(k=>{
            const count=+k.querySelector("input").value||0;
            cptW += 70 + (count * ((k.dataset.kind==="By")?byA:(k.dataset.kind==="Bc")?bcA:mxA)); totalBags+=count; cptULDs++; totalULDCount++;
        });
        const C = c.querySelectorAll(".local-item[data-kind='C']"); totalCargo += C.length;
        C.forEach(i=>cptW+=+i.querySelector("input").value||0);
        const M = c.querySelectorAll(".local-item[data-kind='Mn']"); totalManuel += M.length;
        M.forEach(i=>cptW+=+i.querySelector("input").value||0);
        const eic=c.querySelector(".eic-input"); if(eic) cptW+=+eic.value||0;
        
        let res=[];
        if(cptNum===5) { if(cptBags>0) res.push("B "+cptBags); } 
        else { if(lt==="ULD" && cptULDs>0) res.push("B "+cptULDs); else if(lt==="YIGMA" && cptBags>0) res.push("B "+cptBags); }
        if(C.length) res.push("C "+C.length); if(M.length) res.push("Mn "+M.length);
        c.querySelector('.midBadge').textContent = res.join(" / ");
        outHtml += `<div class="summary-line"><span class="summary-label">CPT ${cptNum}</span> <span class="summary-val">${Math.round(cptW)} kg</span></div>`;
        totalPayload += cptW;
        if(c.querySelector(".weight-display")) c.querySelector(".weight-display").textContent=Math.round(cptW)+" kg";
    });
    let uldLabel = (["A330","A350","B777","B787"].includes(ac)) ? "AKE" : "AKH";
    document.getElementById('summary-list').innerHTML = outHtml;
    document.getElementById('summary-details').innerHTML = lt === "ULD" ? `<div class="summary-detail">üì¶ Toplam ${uldLabel}: ${totalULDCount} (${totalBags} Bagaj)</div>` : `<div class="summary-detail">üì¶ Toplam Bagaj: ${totalBags}</div>`;
    document.getElementById('summary-details').innerHTML += `<div class="summary-detail">üöõ Toplam Kargo (C): ${totalCargo}</div><div class="summary-detail">üõ†Ô∏è Toplam Manuel (Mn): ${totalManuel}</div>`;
    document.getElementById('totalPayload').textContent = Math.round(totalPayload);
    updateWaterSummary();
}

function updateCompartments(r){
    const container = document.getElementById('compartments'); if(r) container.innerHTML="";
    const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value;
    if(!ac || !lt) return;
    let eicT=(ac.includes("B737"))?4:5, eicV=(ac.includes("B737")?23:(ac==="A350"?30:35));
    comps[ac].forEach(n=>{
        const s=document.createElement("section"); s.className="compartment"; s.dataset.num=n;
        s.innerHTML=`<h3 onclick="toggleContent(this)">CPT ${n} <span class="midBadge"></span> <span class="weight-display">0 kg</span></h3>
        <div class="content">
            ${n===eicT?`<div class="item-wrapper eic-wrapper"><span>EIC</span><input type="number" class="eic-input item-input" value="${eicV}" oninput="updateSummary();saveAll()"></div>`:''}
            <div class="bag-section"></div>
            <div class="add-row"><span>Cargo</span><button class="add-btn" onclick="addItem(this,'C')">+</button></div>
            <div class="items-container cargo-items"></div>
            <div class="add-row"><span>Manuel</span><button class="add-btn" onclick="addItem(this,'Mn')">+</button></div>
            <div class="items-container manuel-items"></div>
        </div>`;
        const bSec = s.querySelector(".bag-section");
        if(lt==="YIGMA" || n===5) bSec.innerHTML=`<div class="flex">By<input type="number" class="by" style="width:60px" oninput="updateSummary();saveAll()"> Bc<input type="number" class="bc" style="width:60px" oninput="updateSummary();saveAll()"> Mix<input type="number" class="mx" style="width:60px" oninput="updateSummary();saveAll()"></div>`;
        else bSec.innerHTML=`<div class="add-row"><strong>${ac.includes("B737")||ac.includes("A32")?"AKH":"AKE"}</strong> <select class="bagType"><option>By</option><option>Bc</option><option>Mix</option></select> <button class="add-btn" onclick="addBagaj(this)">+</button></div><div class="items-container uld-items"></div>`;
        container.appendChild(s);
    });
}

function addItem(b,k,v=null){ const h=b.parentElement.nextElementSibling; const d=document.createElement("div"); d.className="local-item item-wrapper"; d.dataset.kind=k; d.innerHTML=`<span>${k} 1</span><input type="number" class="item-input" value="${v||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="this.parentElement.remove(); renumberLocalItems(); updateSummary(); saveAll()">X</button>`; h.appendChild(d); renumberLocalItems(); updateSummary(); saveAll(); }
function addBagaj(b,v=null,kind=null){ const t=kind||b.parentElement.querySelector('.bagType').value, h=b.parentElement.nextElementSibling; const d=document.createElement("div"); d.className="konteyner-item item-wrapper"; d.dataset.kind=t; d.innerHTML=`<span>${t} 1</span><input type="number" class="item-input" value="${v||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="this.parentElement.remove(); renumberGlobalBags(); updateSummary(); saveAll()">X</button>`; h.appendChild(d); renumberGlobalBags(); updateSummary(); saveAll(); }
function renumberGlobalBags(){ ['By','Bc','Mix'].forEach(kind => { let count = 1; document.querySelectorAll(`.konteyner-item[data-kind="${kind}"]`).forEach(el => { el.querySelector('span').textContent = `${kind} ${count++}`; }); }); }
function renumberLocalItems(){ document.querySelectorAll('.compartment').forEach(c => { ['C','Mn'].forEach(kind => { let count = 1; c.querySelectorAll(`.local-item[data-kind="${kind}"]`).forEach(el => { el.querySelector('span').textContent = `${kind} ${count++}`; }); }); }); }

function saveAll(){
    const compsData = [];
    document.querySelectorAll(".compartment").forEach(c => {
        const cargo = []; c.querySelectorAll(".cargo-items .item-input").forEach(i => cargo.push(i.value));
        const manuel = []; c.querySelectorAll(".manuel-items .item-input").forEach(i => manuel.push(i.value));
        const ulds = []; c.querySelectorAll(".uld-items .konteyner-item").forEach(k => ulds.push({k: k.dataset.kind, v: k.querySelector("input").value}));
        compsData.push({ n: c.dataset.num, cargo, manuel, ulds, bulk: { by: c.querySelector(".by")?.value||"", bc: c.querySelector(".bc")?.value||"", mx: c.querySelector(".mx")?.value||"" }, eic: c.querySelector(".eic-input")?.value||"" });
    });
    const data={ ac:document.getElementById('aircraft').value, lt:document.getElementById('loadType').value, p:document.getElementById('pantryInput').value, by:document.getElementById('byAvg').value, bc:document.getElementById('bcAvg').value, n:document.getElementById('note').value, wR:document.getElementById('waterRatio')?.value||"", tG:document.getElementById('tailGroup')?.value||"", tail:document.getElementById('tailInput').value, dest:document.getElementById('destInput').value, compsData };
    localStorage.setItem("hlc_v33_final_v2", JSON.stringify(data));
}

function loadAll(){
    const raw=localStorage.getItem("hlc_v33_final_v2"); if(!raw) return;
    const d=JSON.parse(raw);
    document.getElementById('aircraft').value=d.ac; updateWaterUI();
    document.getElementById('loadType').value=d.lt; if(!d.ac||!d.lt) return;
    updateCompartments(true);
    d.compsData.forEach(cd => {
        const c = document.querySelector(`.compartment[data-num="${cd.n}"]`);
        if(!c) return;
        cd.cargo.forEach(val => addItem(c.querySelector(".cargo-items").previousElementSibling.querySelector("button"), 'C', val));
        cd.manuel.forEach(val => addItem(c.querySelector(".manuel-items").previousElementSibling.querySelector("button"), 'Mn', val));
        cd.ulds.forEach(u => addBagaj(c.querySelector(".uld-items").previousElementSibling.querySelector("button"), u.v, u.k));
        if(c.querySelector(".by")) { c.querySelector(".by").value=cd.bulk.by; c.querySelector(".bc").value=cd.bulk.bc; c.querySelector(".mx").value=cd.bulk.mx; }
        if(c.querySelector(".eic-input")) c.querySelector(".eic-input").value=cd.eic;
    });
    document.getElementById('pantryInput').value=d.p; document.getElementById('byAvg').value=d.by; document.getElementById('bcAvg').value=d.bc;
    document.getElementById('note').value=d.n; document.getElementById('tailInput').value=d.tail||""; document.getElementById('destInput').value=d.dest||"";
    if(d.tG && document.getElementById('tailGroup')) document.getElementById('tailGroup').value=d.tG;
    updateWaterRatios(); if(d.wR) document.getElementById('waterRatio').value=d.wR;
    updateMix(); updateSummary();
}

function updateWaterSummary(){
    const ac=document.getElementById('aircraft').value, ratio=document.getElementById('waterRatio')?.value;
    let wDisp = "-";
    if(ac && ratio && waterData[ac]){
        let v = (ac==="A330"||ac==="A350") ? (waterData[ac][document.getElementById('tailGroup').value]||{})[ratio] : waterData[ac][ratio];
        if(v) wDisp = (ratio==="FULL"?ratio:"%"+ratio)+" / "+v[0]+"kg / "+v[1];
    }
    document.getElementById('finalWater').textContent = wDisp;
    document.getElementById('finalPantry').textContent = document.getElementById('pantryInput').value || "-";
}
function checkLoadType(){ const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value; if(!lt) return; updateCompartments(true); updateSummary(); saveAll(); }
function updateWaterUI() { const ac = document.getElementById('aircraft').value, ui = document.getElementById('waterUI'); ui.innerHTML = ""; if (!ac) return; if (ac === "A330" || ac === "A350") { let opts = ""; Object.keys(waterData[ac]).forEach(g => opts += `<option value="${g}">${g}</option>`); ui.innerHTML += `<div style="font-size:13px; font-weight:bold;">Tescil Grubu:</div><select id="tailGroup" style="width:100%" onchange="updateWaterRatios(); updateSummary(); saveAll()">${opts}</select>`; } ui.innerHTML += `<div style="font-size:13px; font-weight:bold; margin-top:8px;">Su Oranƒ±:</div><select id="waterRatio" style="width:100%" onchange="updateSummary(); saveAll()"><option value="">Se√ß...</option></select>`; updateWaterRatios(); }
function updateWaterRatios() { const ac = document.getElementById('aircraft').value, sel = document.getElementById('waterRatio'); if(!ac || !sel) return; let curr = sel.value; sel.innerHTML = '<option value="">Se√ß...</option>'; let list = (ac==="B787"||ac==="B777") ? ["1/8","FULL"] : (ac==="A350" ? ["1/10","FULL"] : ["25","50","75","FULL"]); list.forEach(o => { let el=document.createElement("option"); el.value=o; el.textContent=(o==="FULL"?o:"%"+o); sel.appendChild(el); }); if(curr) sel.value = curr; }
function updateMix(){ const by=+document.getElementById('byAvg').value||0, bc=+document.getElementById('bcAvg').value||0; document.getElementById('mxAvg').value=(by+bc)>0?Math.round((by+bc)/2):""; updateSummary(); saveAll(); }
function toggleContent(el){ const c=el.nextElementSibling; c.style.display=(c.style.display==='block'?'none':'block'); }
function fullReset(){ document.getElementById('compartments').innerHTML=""; updateSummary(); }
function clearStorage() { if(confirm("T√ºm veriler silinsin mi?")) { localStorage.removeItem("hlc_v33_final_v2"); location.reload(); } }
window.onload=loadAll;
</script>
</body>
</html>
