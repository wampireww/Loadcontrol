<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Load Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<style>
html, body { overscroll-behavior-y: contain; }
body{font-family: Arial, sans-serif; background:#f0f2f5; margin:5px; padding-bottom:150px; color: #333;}
section{background:#fff; border:1px solid #ccc; border-radius:8px; padding:6px; margin-bottom:6px;}
h1{text-align:center; color:#004080; margin:5px; font-size:1.1em;}
h3{cursor:pointer; margin:2px 0; display:flex; align-items:center; font-size: 0.95em; color:#004080; font-weight: bold;}
.flex{display:flex; flex-wrap:wrap; align-items:center; gap:4px;}

/* İnput ve Genel Yükseklik Revizesi */
input[type=number], input[type=text], select{padding:1px 4px; border:1px solid #ccc; border-radius:4px; font-size: 14px; font-weight: bold; height: 26px; box-sizing: border-box;}
.add-btn {background:#004080; color:#fff; border:none; border-radius:4px; padding:0 8px; cursor:pointer; font-weight: bold; font-size: 14px; height: 26px;}
.midBadge { font-size: 0.8em; color: #004080; font-weight: 900; flex-grow: 1; text-align: center; }

/* Kargo/Manuel Kutuları */
.item-wrapper { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    background: #fff; 
    padding: 3px 6px; 
    border-radius: 6px; 
    border: 1.5px solid #004080; 
    width: 49%; 
    box-sizing: border-box; 
    margin-bottom: 4px; 
}

.eic-wrapper { background: #fff2cc !important; border-color: #f1c232 !important; width: 100% !important; height: 32px; }
.items-container { display: flex; flex-wrap: wrap; gap: 2%; margin-top: 4px; }

/* İnput Genişliği ve Yüksekliği */
.item-input { 
    width: 62px !important; 
    height: 22px !important; 
    font-weight: 900; 
    border: 1.2px solid #555 !important; 
    font-size: 14px !important; 
    text-align: center;
}

.delete-btn { background: #cc0000; padding: 0 6px; font-size: 0.8em; border-radius: 4px; color: white; border:none; font-weight: bold; height: 22px;}
.weight-display { font-size: 0.9em; color: #004080; font-weight: 900; background: #e6f0ff; padding: 2px 6px; border-radius: 4px; min-width: 55px; text-align: center; }

/* Özet ve Ana Butonlar */
.summary{ background:#004080; color: white; padding:10px; border-radius: 10px; margin-top:8px;}
.summary h3 { font-size: 0.95em; color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 4px; cursor: default;}
#note { width: 100%; height: 45px; margin-top: 6px; border-radius: 6px; padding: 6px; font-size: 13px; font-weight: bold; border: none; box-sizing: border-box; resize: none;}

/* Kaydet/Sıfırla Buton Yüksekliği düşürüldü */
.action-btn { 
    flex: 1; 
    padding: 6px 0; 
    border-radius: 5px; 
    border: none; 
    color: white; 
    font-weight: bold; 
    font-size: 13px; 
    cursor: pointer; 
    height: 32px; /* Eskiden 40-45px civarıydı, şimdi daha ince */
}
.content { display: none; padding: 6px; border-top: 1px solid #eee; }
</style>
</head>
<body>

<h1>HLC Pro V28</h1>

<section class="flex" style="justify-content: center;">
    Uçak: <select id="aircraft" onchange="fullReset();checkLoadType();updateWaterUI();updateSummary();saveAll()">
        <option value="">Seç</option>
        <option>A319</option><option>A320</option><option>A321</option><option>B737</option>
        <option>A330</option><option>A350</option><option>B777</option><option>B787</option>
    </select>
    Yükleme: <select id="loadType" onchange="checkLoadType();saveAll()">
        <option value="">Seç</option><option value="YIGMA">Yığma</option><option value="ULD">ULD</option>
    </select>
</section>

<section>
    <h3 onclick="toggleContent(this)">Water & Pantry</h3>
    <div class="content">
        <div id="waterUI" class="flex" style="flex-direction:column; gap:5px;"></div>
        <div class="flex" style="margin-top:6px;">
            Pantry: <input type="text" id="pantryInput" style="flex-grow:1" oninput="saveAll();updateSummary()">
        </div>
    </div>
</section>

<section>
    <h3 onclick="toggleContent(this)">Bagaj Ortalamaları</h3>
    <div class="content" style="display: block;">
        <div class="flex" style="font-weight: bold; justify-content: space-between;">
            By <input type="number" id="byAvg" style="width:50px" oninput="updateMix()">
            Bc <input type="number" id="bcAvg" style="width:50px" oninput="updateMix()">
            Mix <input type="number" id="mxAvg" style="width:50px" readonly>
        </div>
    </div>
</section>

<div id="compartments"></div>

<section class="summary">
    <h3>Final Kontrol</h3>
    <div id="summary" style="font-size: 0.9em; line-height: 1.3;"></div>
    <div style="margin-top:6px; border-top: 1px solid rgba(255,255,255,0.15); padding-top:6px; font-weight:bold; font-size: 0.85em;">
        <div>Water: <span id="finalWater">-</span></div>
        <div>Pantry: <span id="finalPantry">-</span></div>
    </div>
    <textarea id="note" placeholder="Notlar..." oninput="saveAll()"></textarea>
    <div class="flex" style="margin-top:6px; gap:6px;">
        <button class="action-btn" onclick="saveAll()" style="background: #27ae60;">KAYDET</button>
        <button class="action-btn" onclick="clearStorage()" style="background:#c0392b;">SIFIRLA</button>
    </div>
</section>

<script>
// (Buradaki JavaScript mantığı V27 ile aynıdır, sadece Huawei/Saha uyumlu görsel düzeltmeler içerir)
const waterData = {
    "A330": {
        "JNA ... JNB": {"25": [-525,-2.6],"50": [-350,-1.7],"75": [-175,-0.9],"FULL": [0,0]},
        "JNF ... JNK": {"25": [-788,-3.5],"50": [-525,-2.4],"75": [-263,-1.2],"FULL": [0,0]},
        "JNH ... JNZ": {"25": [-525,-2.0],"50": [-350,-1.4],"75": [-175,-0.7],"FULL": [0,0]},
        "TC-LOA ... LOZ": {"25": [-788,-4.2],"50": [-525,-2.8],"75": [-263,-1.4],"FULL": [0,0]}
    },
    "A350": {
        "LGA ... LGP (A-C Grubu)": {"1/10":[-954,-4.4],"2/10":[-848,-3.9],"3/10":[-742,-3.4],"4/10":[-636,-2.9],"5/10":[-530,-2.4],"6/10":[-424,-1.9],"7/10":[-318,-1.5],"8/10":[-212,-1.0],"9/10":[-106,-0.5],"FULL":[0,0]},
        "LGI ... LGL (I-L Grubu)": {"1/10":[-1017,-6.6],"2/10":[-904,-5.9],"3/10":[-791,-5.1],"4/10":[-678,-4.3],"5/10":[-565,-3.6],"6/10":[-452,-2.9],"7/10":[-339,-2.2],"8/10":[-226,-1.4],"9/10":[-113,-0.7],"FULL":[0,0]}
    },
    "B787": {"1/8": [-924,-3.9], "2/8": [-792,-3.3], "3/8": [-660,-2.8], "4/8": [-528,-2.2], "5/8": [-396,-1.7], "6/8": [-264,-1.1], "7/8": [-132,-0.6], "FULL": [0,0]},
    "B777": {"1/8": [-1172,-3.9], "2/8": [-1004,-3.3], "3/8": [-837,-2.8], "4/8": [-670,-2.2], "5/8": [-502,-1.6], "6/8": [-335,-1.1], "7/8": [-167,-0.5], "FULL": [0,0]},
    "B737": {"25": [-177,-2.5], "50": [-118,-1.7], "75": [-59,-0.8], "FULL": [0,0]},
    "A319": {"25": [-150,-1.7], "50": [-100,-1.1], "75": [-50,-0.6], "FULL": [0,0]},
    "A320": {"25": [-150, 0.5], "50": [-100, 0.3], "75": [-50, 0.2], "FULL": [0,0]},
    "A321": {"25": [-150,-2.3], "50": [-100,-1.6], "75": [-50,-0.8], "FULL": [0,0]}
};

const comps={A319:[1,4,5],A320:[1,3,4,5],A321:[1,2,3,4,5],B737:[1,2,3,4],A330:[1,2,3,4,5],A350:[1,2,3,4,5],B777:[1,2,3,4,5],B787:[1,2,3,4,5]};
const wide=["A330","A350","B777","B787"];

function updateWaterUI() {
    const ac = document.getElementById('aircraft').value, ui = document.getElementById('waterUI'); ui.innerHTML = "";
    if (!ac) return;
    if (ac === "A330" || ac === "A350") {
        ui.innerHTML += `<div style="font-weight:bold; font-size:13px;">Tescil:</div><select id="tailGroup" style="width:100%" onchange="updateWaterRatios(); updateSummary(); saveAll()"><option value="">Seçiniz</option>${Object.keys(waterData[ac]).map(k=>`<option value="${k}">${k}</option>`).join('')}</select>`;
    }
    ui.innerHTML += `<div style="font-weight:bold; font-size:13px;">Su Oranı:</div><select id="waterRatio" style="width:100%" onchange="updateSummary(); saveAll()"><option value="">Seçiniz</option></select>`;
    updateWaterRatios();
}

function updateWaterRatios() {
    const ac = document.getElementById('aircraft').value, ratioSel = document.getElementById('waterRatio'); if(!ac || !ratioSel) return;
    let current = ratioSel.value; ratioSel.innerHTML = '<option value="">Seçiniz</option>';
    let opts = (ac==="B787"||ac==="B777") ? ["1/8","2/8","3/8","4/8","5/8","6/8","7/8","FULL"] : (ac==="A350" ? ["1/10","2/10","3/10","4/10","5/10","6/10","7/10","8/10","9/10","FULL"] : ["25","50","75","FULL"]);
    opts.forEach(o => { let el = document.createElement("option"); el.value=o; el.textContent=(o==="FULL"?o:(o.includes("/")?o:"%"+o)); ratioSel.appendChild(el); });
    if(current) ratioSel.value = current;
}

function updateSummary(){
    let out=""; const byA=+document.getElementById('byAvg').value||0, bcA=+document.getElementById('bcAvg').value||0, mxA=+document.getElementById('mxAvg').value||0;
    document.querySelectorAll(".compartment").forEach(c=>{
        let t=0; const eic=c.querySelector(".eic-input"); if(eic) t+=+eic.value||0;
        c.querySelectorAll(".by").forEach(i=>t+=(+i.value||0)*byA);
        c.querySelectorAll(".bc").forEach(i=>t+=(+i.value||0)*bcA);
        c.querySelectorAll(".mx").forEach(i=>t+=(+i.value||0)*mxA);
        c.querySelectorAll(".konteyner-item").forEach(k=>{ t += 70 + ((+k.querySelector("input").value||0) * (k.dataset.kind==="By"?byA:k.dataset.kind==="Bc"?bcA:mxA)); });
        c.querySelectorAll(".local-item").forEach(i=>t+=+i.querySelector("input").value||0);
        c.querySelector(".weight-display").textContent=Math.round(t)+" kg";
        out+=`C${c.dataset.num}: <strong>${Math.round(t)}</strong> | `;
    });
    document.getElementById('summary').innerHTML=out;
    const ac=document.getElementById('aircraft').value, ratio=document.getElementById('waterRatio')?.value;
    let wDisp="-";
    if(ac && ratio && waterData[ac]){
        let v; if(ac==="A330" || ac==="A350"){ const tg=document.getElementById('tailGroup')?.value; v=tg?waterData[ac][tg][ratio]:null; } else v=waterData[ac][ratio];
        if(v) wDisp=`${ratio} (${v[0]}kg / ${v[1]})`;
    }
    document.getElementById('finalWater').textContent=wDisp;
    document.getElementById('finalPantry').textContent=document.getElementById('pantryInput').value||"-";
    updateCPTBadge();
}

function updateCompartments(r){
    const container = document.getElementById('compartments'); if(r) container.innerHTML="";
    const ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value;
    if(!ac || !lt) return;
    let eicV = (ac==="B737")?23:(["A319","A320","A321"].includes(ac))?35:(["A330","A350"].includes(ac))?58:30;
    comps[ac].forEach(n=>{
        const s=document.createElement("section"); s.className="compartment"; s.dataset.num=n;
        s.innerHTML=`<h3 onclick="toggleContent(this)">CPT ${n} <span class="midBadge"></span> <span class="weight-display">0 kg</span></h3>
        <div class="content">
            ${(n===5||(ac==="B737"&&n===4))?`<div class="item-wrapper eic-wrapper"><span>EIC</span><input type="number" class="eic-input" value="${eicV}" oninput="updateSummary();saveAll()"></div>`:''}
            <div class="bag-section"></div>
            <div style="margin-top:4px;">Cargo <button class="add-btn" onclick="addItem(this,'Cargo')">+</button></div><div class="items-container cargo-items"></div>
            <div style="margin-top:4px;">Manuel <button class="add-btn" onclick="addItem(this,'Manuel')">+</button></div><div class="items-container manuel-items"></div>
        </div>`;
        const bSec = s.querySelector(".bag-section");
        if(lt==="YIGMA" || n===5) bSec.innerHTML=`<div class="flex">By<input type="number" class="by" style="width:35px" oninput="updateSummary()"> Bc<input type="number" class="bc" style="width:35px" oninput="updateSummary()"> Mx<input type="number" class="mx" style="width:35px" oninput="updateSummary()"></div>`;
        else bSec.innerHTML=`<div class="flex"><strong>${wide.includes(ac)?"AKE":"AKH"}</strong> <select class="bagType"><option>By</option><option>Bc</option><option>Mix</option></select> <button class="add-btn" onclick="addBagaj(this)">+</button></div><div class="items-container uld-items"></div>`;
        container.appendChild(s);
    });
}

function addItem(b,k,v=null){
    const h=b.parentElement.nextElementSibling, d=document.createElement("div"); d.className="local-item item-wrapper"; d.dataset.kind=k;
    d.innerHTML=`<span>${k}</span><input type="number" class="item-input" value="${v||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="this.parentElement.remove(); renumberLocalItems('${k}'); updateSummary(); saveAll()">X</button>`;
    h.appendChild(d); renumberLocalItems(k); updateSummary();
}
function addBagaj(b,v=null){
    const t=b.parentElement.querySelector('.bagType').value, h=b.parentElement.nextElementSibling, d=document.createElement("div"); d.className="konteyner-item item-wrapper"; d.dataset.kind=t;
    d.innerHTML=`<span>${t}</span><input type="number" class="item-input" value="${v||''}" oninput="updateSummary();saveAll()"><button class="delete-btn" onclick="this.parentElement.remove(); renumberGlobalBags(); updateSummary(); saveAll()">X</button>`;
    h.appendChild(d); renumberGlobalBags(); updateSummary();
}

function renumberGlobalBags(){ ['By','Bc','Mix'].forEach(k=>{ let c=1; document.querySelectorAll(`.konteyner-item[data-kind="${k}"] span`).forEach(s=>s.textContent=`${k} ${c++}`); }); }
function renumberLocalItems(k){ let c=1; document.querySelectorAll(`.local-item[data-kind="${k}"] span`).forEach(s=>s.textContent=`${k} ${c++}`); }
function toggleContent(el){ let c=el.nextElementSibling; c.style.display=(c.style.display==='block'?'none':'block'); }
function updateMix(){ let by=+document.getElementById('byAvg').value||0, bc=+document.getElementById('bcAvg').value||0; document.getElementById('mxAvg').value=(by+bc)>0?Math.round((by+bc)/2):""; updateSummary(); }
function fullReset(){ document.getElementById('compartments').innerHTML=""; updateSummary(); }
function checkLoadType(){ let ac=document.getElementById('aircraft').value, lt=document.getElementById('loadType').value; if(ac&&lt) updateCompartments(true); }
function updateCPTBadge(){ document.querySelectorAll('.compartment').forEach(c=>{ let B=0, C=c.querySelectorAll('.local-item[data-kind="Cargo"]').length, M=c.querySelectorAll('.local-item[data-kind="Manuel"]').length; let lt=document.getElementById('loadType').value; if(lt==='YIGMA'||c.dataset.num==="5"){c.querySelectorAll('.by,.bc,.mx').forEach(i=>B+=+i.value||0);}else{B=c.querySelectorAll('.konteyner-item').length;} let r=[]; if(B)r.push("B"+B); if(C)r.push("C"+C); if(M)r.push("M"+M); c.querySelector('.midBadge').textContent=r.join("/"); }); }

function saveAll(){
    const data={ ac:document.getElementById('aircraft').value, lt:document.getElementById('loadType').value, p:document.getElementById('pantryInput').value, by:document.getElementById('byAvg').value, bc:document.getElementById('bcAvg').value, n:document.getElementById('note').value, wR:document.getElementById('waterRatio')?.value, tG:document.getElementById('tailGroup')?.value, comps:[] };
    document.querySelectorAll('.compartment').forEach(c=>{
        let co={num:c.dataset.num, y:[], i:[], e:c.querySelector('.eic-input')?.value};
        c.querySelectorAll('.by,.bc,.mx').forEach(i=>co.y.push(i.value));
        c.querySelectorAll('.item-wrapper:not(.eic-wrapper)').forEach(iw=>co.i.push({k:iw.dataset.kind, v:iw.querySelector('input').value, isK:iw.classList.contains('konteyner-item')}));
        data.comps.push(co);
    });
    localStorage.setItem("hlc_v28", JSON.stringify(data));
}
function loadAll(){
    const raw=localStorage.getItem("hlc_v28"); if(!raw) return;
    const d=JSON.parse(raw); document.getElementById('aircraft').value=d.ac; updateWaterUI(); document.getElementById('loadType').value=d.lt; checkLoadType();
    document.getElementById('pantryInput').value=d.p||""; document.getElementById('byAvg').value=d.by||""; document.getElementById('bcAvg').value=d.bc||""; document.getElementById('note').value=d.n||"";
    if(d.tG && document.getElementById('tailGroup')){ document.getElementById('tailGroup').value=d.tG; updateWaterRatios(); }
    if(d.wR && document.getElementById('waterRatio')) document.getElementById('waterRatio').value=d.wR;
    const domC=document.querySelectorAll('.compartment');
    d.comps.forEach((cd,idx)=>{
        const dc=domC[idx]; if(!dc) return; if(cd.e && dc.querySelector('.eic-input')) dc.querySelector('.eic-input').value=cd.e;
        const yi=dc.querySelectorAll('.by,.bc,.mx'); cd.y.forEach((v,i)=>{if(yi[i]) yi[i].value=v;});
        cd.i.forEach(it=>{ if(it.isK){ dc.querySelector('.bagType').value=it.k; addBagaj(dc.querySelector('.uld-items').previousElementSibling.querySelector('button'), it.v); } else { addItem(dc.querySelector(it.k==='Cargo'?'.cargo-items':'.manuel-items').previousElementSibling.querySelector('button'), it.k, it.v); } });
    });
    updateSummary();
}
function clearStorage(){ if(confirm("Sıfırlansın mı?")){ localStorage.removeItem("hlc_v28"); location.reload(); } }
window.onload=loadAll;
</script>
</body>
</html>
